<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${mealPlan.name} + ' - Event Meal Planner'">Meal Plan View</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand"><a th:href="@{/}">Event Meal Planner v2</a></div>
        <ul class="nav-links">
            <li class="nav-dropdown">
                <span>Planning</span>
                <ul class="dropdown-menu">
                    <li><a th:href="@{/meal-plans}">Meal Plans</a></li>
                    <li><a th:href="@{/event-days}">Event Days</a></li>
                    <li><a th:href="@{/kitchen-prep}">Kitchen Prep</a></li>
                </ul>
            </li>
            <li class="nav-dropdown">
                <span>Catalog</span>
                <ul class="dropdown-menu">
                    <li><a th:href="@{/menus}">Menus</a></li>
                    <li><a th:href="@{/menu-items}">Menu Items</a></li>
                    <li><a th:href="@{/ingredients}">Ingredients</a></li>
                </ul>
            </li>
            <li class="nav-dropdown">
                <span>Reservations</span>
                <ul class="dropdown-menu">
                    <li><a th:href="@{/group-reservations}">Group Reservations</a></li>
                    <li><a th:href="@{/attendance}">Meal Attendance</a></li>
                </ul>
            </li>
            <li><a th:href="@{/purchase-lists}">Purchasing</a></li>
            <li><a th:href="@{/dashboard}">Dashboard</a></li>
        </ul>
    </nav>

    <main class="container">
        <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>

        <div class="page-header">
            <h1 th:text="${mealPlan.name}">Meal Plan Name</h1>
            <div class="actions">
                <a th:href="@{/meal-plans/{id}/edit(id=${mealPlan.mealPlanId})}" class="btn btn-secondary">Edit</a>
                <a th:href="@{/purchase-lists/generate/{id}(id=${mealPlan.mealPlanId})}" class="btn btn-success">Generate Purchase List</a>
                <a th:href="@{/meal-plans}" class="btn btn-secondary">Back to List</a>
            </div>
        </div>

        <div class="card mb-2">
            <p><strong>Start Date:</strong> <span th:text="${#temporals.format(mealPlan.startDate, 'EEEE, MMMM d, yyyy')}"></span></p>
            <p><strong>End Date:</strong> <span th:text="${#temporals.format(mealPlan.endDate, 'EEEE, MMMM d, yyyy')}"></span></p>
            <p><strong>Total Days:</strong> <span th:text="${mealPlan.eventDays.size()}"></span></p>
        </div>

        <h2 class="mb-1">Attending Groups (<span th:text="${attendingGroups.size()}"></span>)</h2>
        <div th:if="${attendingGroups.empty}" class="card mb-2">
            <p class="text-muted">No groups are scheduled during this meal plan period.</p>
            <a th:href="@{/group-reservations/new}" class="btn btn-primary btn-sm">Add Group Reservation</a>
        </div>

        <div th:unless="${attendingGroups.empty}">
            <div class="table-container mb-2">
                <table>
                    <thead>
                        <tr>
                            <th>Group Name</th>
                            <th>Arrival</th>
                            <th>Departure</th>
                            <th>Adults</th>
                            <th>Youth</th>
                            <th>Kids</th>
                            <th>Code</th>
                            <th>Custom Diet</th>
                            <th>Total</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="group : ${attendingGroups}">
                            <td th:text="${group.groupName}"></td>
                            <td th:text="${#temporals.format(group.arrivalDate, 'MMM d')}"></td>
                            <td th:text="${#temporals.format(group.departureDate, 'MMM d')}"></td>
                            <td th:text="${group.defaultAdultCount}"></td>
                            <td th:text="${group.defaultYouthCount}"></td>
                            <td th:text="${group.defaultKidCount}"></td>
                            <td th:text="${group.defaultCodeCount}"></td>
                            <td>
                                <span th:text="${group.defaultCustomDietCount}"></span>
                                <span th:if="${group.customDietNotes}" class="text-muted" th:title="${group.customDietNotes}">*</span>
                            </td>
                            <td><strong th:text="${group.defaultAdultCount + group.defaultYouthCount + group.defaultKidCount + group.defaultCodeCount}"></strong></td>
                            <td>
                                <a th:href="@{/group-reservations/{id}(id=${group.groupReservationId})}" class="btn btn-sm btn-secondary">View</a>
                            </td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr style="background-color: #f0f0f0; font-weight: bold;">
                            <td colspan="3">Totals</td>
                            <td th:text="${totalAdults}"></td>
                            <td th:text="${totalYouth}"></td>
                            <td th:text="${totalKids}"></td>
                            <td th:text="${totalCode}"></td>
                            <td th:text="${totalCustomDiet}"></td>
                            <td th:text="${grandTotal}"></td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            </div>

            <div th:if="${totalCustomDiet > 0}" class="card mb-2">
                <h3>Custom Diet Notes</h3>
                <ul>
                    <li th:each="group : ${attendingGroups}" th:if="${group.defaultCustomDietCount > 0 && group.customDietNotes != null}">
                        <strong th:text="${group.groupName}"></strong>: <span th:text="${group.customDietNotes}"></span>
                    </li>
                </ul>
            </div>
        </div>

        <h2 class="mb-1">Event Days</h2>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Breakfast</th>
                        <th>Lunch</th>
                        <th>Dinner</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="day : ${mealPlan.eventDays}">
                        <td th:text="${#temporals.format(day.date, 'EEE, MMM d')}"></td>
                        <td th:each="period : ${day.mealPeriods}" th:if="${period.mealPeriodType.name() == 'BREAKFAST'}">
                            <span th:if="${period.menu != null}" th:text="${period.menu.menuName}"></span>
                            <span th:unless="${period.menu != null}" class="text-muted">Not assigned</span>
                        </td>
                        <td th:each="period : ${day.mealPeriods}" th:if="${period.mealPeriodType.name() == 'LUNCH'}">
                            <span th:if="${period.menu != null}" th:text="${period.menu.menuName}"></span>
                            <span th:unless="${period.menu != null}" class="text-muted">Not assigned</span>
                        </td>
                        <td th:each="period : ${day.mealPeriods}" th:if="${period.mealPeriodType.name() == 'DINNER'}">
                            <span th:if="${period.menu != null}" th:text="${period.menu.menuName}"></span>
                            <span th:unless="${period.menu != null}" class="text-muted">Not assigned</span>
                        </td>
                        <td>
                            <a th:href="@{/event-days/{id}(id=${day.eventDayId})}" class="btn btn-sm btn-primary">View Day</a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </main>

    <footer class="footer"><p>Event Meal Planner v2 - Testing Interface</p></footer>
    <script th:src="@{/js/main.js}"></script>
</body>
</html>
